---
title: "Gov 50 Final Project"
author: "Kay Rollins"
description: "My final project"
output:
  distill::distill_article:
    self_contained: false
---

##Project Proposal 
Although I was originally planning on pursuing a project about militia membership, given the restrictions on that data I have decided to switch my project to one focused on the death penalty. My research question is does the death penalty deter violent crime and homicide? In this study, I plan to compare homicide and crime rates in counties where the death penalty is applied and counties where it is not. In order to do this analysis, I will try to use a difference in differences method to the extent that is possible with this data. First, I will utilize states with a recent abolition of the death penalty to directly compare the death penalty eligible crime rate in a county before and after the death penalty was abolished (for instance, comparing homicide rates in Fairfax county before and after 2021 when the death penalty was abolished in Virginia). Second, I will compare counties between states over time-- did the counties in states which maintained the death penalty have a lower rate of death-eligable crimes compared to similar counties over the same period of time in places without the death penalty? My data composed of all executions from 1976 to 2022 from the death penalty information center. I will be merging this data with the FBI crime data explorer database to compare crimes by type and county. My unit of analysis is a county's crime in one year. The explanatory variable of interest is whether there is the presence of a death penalty in a certain jurisdiction. This will be coded as 1 = death penalty possible and 0= death penalty not possible. My outcome variable will be the count of death penalty eligible crimes in a county in a certain year. For instance, if the variable were coded as "40", it means that there were 40 death penalty eligible crimes in the county in a year. This variable is measured based on the FBI's database. If I observe greater or equal levels of death penalty eligable crime in a county with the death penalty than one without it (or the same county either with or without it), then my hypothesis will be proved correct. If there is lower rates of these type of crimes in places with the death penalty, then my hypothesis would be wrong.

```{r}
library(tidyverse)
library(ggplot2)
library(dplyr)
library(infer)
```
```{r}
executions<-read_csv("DPIC Execution Database - U.S. Executions.csv")

homicide<- read_csv("Death Data.csv")

sentences <-read_csv("1991_2017_individualFIPS.csv-1991_2019_individualFIPS.csv")

```
```{r}
##Give Sentences a County_code category 
sentences$county_code <- paste(sentences$fips_st,sentences$fips,sep="")

```


```{r}
#DP Sentences County by County 
sentences_count <- sentences |> 
  group_by(county,state,year,county_code) |>
  summarize(sent=n())
sentences_count
```

```{r}
##Execution Count by County 
execution_count<- sentences |>
  filter(Executed == "Executed") |>
  mutate(ExecutionDate=lubridate::mdy(DateofExecution)) |>
  mutate(ExecutionYear = lubridate::year(ExecutionDate)) |>
  group_by(county, county_code, ExecutionYear) |>
  summarize (exs=n())
execution_count
```

```{r}
##Reading in new data
full2022<- read_csv("2022f.csv")
full2021<- read_csv("2021f.csv")
full2020<- read_csv("2020f.csv")
full2019<- read_csv("2019f.csv")
full2018<- read_csv("2018f.csv")
full2017<- read_csv("2017f.csv")
full2016<- read_csv("2016f.csv")
full2015<- read_csv("2015f.csv")
full2014<- read_csv("2014f.csv")
full2013<- read_csv("2013f.csv")
full2012<- read_csv("2012f.csv")
full2011<- read_csv("2011f.csv")
full2010<-read_csv("2010f.csv")
```

```{r}
##refine the data 
hom2010<-full2010 |>
  select(`5-digit FIPS Code`, `State Abbreviation`, `Name`, `Homicides raw value`,`Homicides numerator`, `Violent crime raw value`)|>
  mutate(year = "2010")
hom2011<- full2011 |>
  select(`5-digit FIPS Code`, `State Abbreviation`, `Name`, `Homicides raw value`,`Homicides numerator`, `Violent crime raw value`)|>
  mutate(year = "2011")
hom2012<- full2012 |>
  select(`5-digit FIPS Code`, `State Abbreviation`, `Name`, `Homicides raw value`,`Homicides numerator`, `Violent crime raw value`)|>
  mutate(year = "2012")
hom2013<- full2013 |>
  select(`5-digit FIPS Code`, `State Abbreviation`, `Name`, `Homicides raw value`,`Homicides numerator`, `Violent crime raw value`)|>
  mutate(year = "2013")
hom2014<- full2014 |>
  select(`5-digit FIPS Code`, `State Abbreviation`, `Name`, `Homicides raw value`,`Homicides numerator`, `Violent crime raw value`)|>
  mutate(year = "2014")
hom2015<- full2015 |>
  select(`5-digit FIPS Code`, `State Abbreviation`, `Name`, `Homicides raw value`,`Homicides numerator`, `Violent crime raw value`)|>
  mutate(year = "2015")
hom2016<- full2016 |>
  select(`5-digit FIPS Code`, `State Abbreviation`, `Name`, `Homicides raw value`,`Homicides numerator`, `Violent crime raw value`)|>
  mutate(year = "2016")
hom2017<- full2017 |>
  select(`5-digit FIPS Code`, `State Abbreviation`, `Name`, `Homicides raw value`,`Homicides numerator`, `Violent crime raw value`)|>
  mutate(year = "2017")
hom2018<- full2018 |>
  select(`5-digit FIPS Code`, `State Abbreviation`, `Name`, `Homicides raw value`,`Homicides numerator`, `Violent crime raw value`)|>
  mutate(year = "2018")
hom2019<-full2019 |>
  select(`5-digit FIPS Code`, `State Abbreviation`, `Name`, `Homicides raw value`,`Homicides numerator`, `Violent crime raw value`)|>
  mutate(year = "2019")
hom2020<-full2020 |>
  select(`5-digit FIPS Code`, `State Abbreviation`, `Name`, `Homicides raw value`,`Homicides numerator`, `Violent crime raw value`)|>
  mutate(year = "2020")
hom2021<-full2021 |>
  select(`5-digit FIPS Code`, `State Abbreviation`, `Name`, `Homicides raw value`,`Homicides numerator`, `Violent crime raw value`)|>
  mutate(year = "2021")
hom2022<-full2022 |>
  select(`5-digit FIPS Code`, `State Abbreviation`, `Name`, `Homicides raw value`,`Homicides numerator`, `Violent crime raw value`)|>
  mutate(year = "2022")
```

```{r}
##Make data into megafile 
megafile<- rbind(hom2022,hom2021,hom2020,hom2019,hom2018,hom2017,hom2016,hom2014,hom2013,hom2012,hom2011,hom2010)

```

```{r}
##make sure there is a county code column
 megafile<-megafile|>
  mutate(county_code = `5-digit FIPS Code`) 
megafile
```



```{r}
##make sentences and megafile years compatable and make state colum in megafile
sentences_count$year <- as.integer(as.character(sentences_count$year))
sentences_count

megafile$year <- as.integer(as.character(megafile$year))


names(megafile)[names(megafile) == "Name"] <- "county_name"
names(megafile)[names(megafile) == "State Abbreviation"] <- "State_id"
names(megafile)[names(megafile) == "Homicides raw value"] <- "Homicides_value"
names(megafile)[names(megafile) == "Violent crime raw value"] <- "Violence_value"



megafile
```
```{r}
##give executions count a year column
names(execution_count)[names(execution_count) == "ExecutionYear"] <- "year"

```


```{r}
##Merging sentences, and megafile data 
sentences_megafile<-megafile|>
  left_join(sentences_count) |>
  select(county_code, State_id, county_name, year,Violence_value, Homicides_value, sent)
alldata<-sentences_megafile|>
  left_join(execution_count) |>
  select(county_code, State_id, county_name, year, Violence_value, Homicides_value, exs, sent)
alldata
```

```{r}
##Making Sent and Exs 0 if none are there
alldata <- alldata |> 
  mutate(exs = ifelse(is.na(exs), 0, exs))
alldata <- alldata |>
  mutate(sent = ifelse(is.na(sent), 0, sent))
```

```{r}
## The first part of my analysis will be to compare the same counties before and after that state got rid of the death penalty. The states that eliminated the death penalty (or put in place a moratorium) within the time of my data (2010-2022) are Virginia 2021 (FIPS codes 51001-51840) Maryland 2013 (24001-24510) Washington 2018 (53001-53077) New Hampshire 2019 (33001-33019) Connecticut 2012 (09001-09015) Deleware 2016 (10001-10005) Colorado 2020 (08001-08125) Illinois 2011 (17001-17203) Pennsylvania 2015 (42001-42113) *California 2019 (06001-06115)* Oregon 2011 (41001-41071) *. In order to do this analysis, I need to create a new dataframe from my alldata one which only gives information for counties within these states (1) and tags the data as before or after the death penalty was eliminated (2)

##1: 
alldata$county_code <- as.numeric(as.character(alldata$county_code))

alldata |>
  subset(county_code == 51001:51840)


```


```{r}
alldata<- subset(alldata, alldata$county_code != "0" & alldata$county_code != "fipscode")

alldata$Homicides_value <- as.integer(as.character(alldata$Homicides_value))
homicidesvsexe<- alldata|>
  group_by(ne) |>
  summarize(Homicideave = mean(Homicides_value, na.rm = TRUE))

ggplot(homicidesvsexe, aes(x = ne, y = Homicideave)) +
geom_point() +
  labs(title = "Homicide Rate in Death Penalty Counties VS Number of Executions that Year",x = "Number of executions", y = "Average Count of Homicides")

```
This graph depicts the number of executions across all counties that executed someone and the average homicide rate for that county in the year they executed someone. From the graph, we can see that the more executions there are, the higher the homicide rate tends to be. 